import{_ as I,a as S}from"./Searchbar.5b967837.js";import{d as b,u as $,C as T,r as d,c as v,n as C,_ as B,o as f,e as m,f as p,t as g,z as F,A as D,q as R,x as U,s as E,i as h,j as V,T as q}from"./index.29837664.js";import"./time.747ead48.js";function z(t){return t===0?"0":t.toString().replace(/^0+/,"").replace(/[^0-9]/g,"").replace(/\B(?=(\d{3})+(?!\d))/g,",")}const H=b({name:"Track",components:{},setup(){const t=$(),n=T(),s=d(""),r=d(!1),a=v(()=>t.getters["user/otherUserInfo"]),c=v(()=>t.getters["user/userInfo"]),i=v(()=>n.params.id),l=()=>{r.value=a.value.beFollowed.some(o=>o.id===c.value.id),s.value=r.value?"\u53D6\u6D88\u8FFD\u8E64":"\u8FFD\u8E64"};return C(async()=>{await t.dispatch("user/getOtherUser",{id:i.value}),l()}),{userInfo:c,uProfile:a,thousandSeparator:z,updateFollow:async(o,P)=>{await t.dispatch("user/updateFollower",{userId:o,followId:P}),l()},trackText:s,isTrack:r}}}),M={class:"track-container radius track",style:{"margin-bottom":"14px"}},j={class:"track-content"},A=["src"],O={style:{"margin-left":"16px"}},G={class:"track-content__name"},J={key:0,class:"track-content__text"};function K(t,n,s,r,a,c){return f(),m("div",M,[p("div",j,[p("img",{class:"track-content__img",src:t.uProfile.avatar,alt:"\u8FFD\u8E64\u9019\u7167\u7247"},null,8,A),p("div",O,[p("p",G,g(t.uProfile.userName),1),t.uProfile.follow?(f(),m("p",J,g(t.thousandSeparator(t.uProfile.beFollowed.length)+" \u4EBA\u8FFD\u8E64"),1)):F("",!0)]),p("button",{class:D(["btn secondary small",{tracked:t.isTrack}]),onClick:n[0]||(n[0]=i=>t.updateFollow(t.userInfo.id,t.uProfile._id))},g(t.trackText),3)])])}var L=B(H,[["render",K],["__scopeId","data-v-2b7be9be"]]);const Q=b({name:"Personal",components:{Track:L,Searchbar:I,Posts:S},setup(){var w,k;const t=$(),n=T(),s=d([]),r=d(null),a=(w=t.getters["user/userInfo"])==null?void 0:w.id,c=(k=n.params)==null?void 0:k.id,i=d(a==c),l=async()=>{const{page:e,hasNextPage:_}=o.value;_&&(await t.dispatch("post/fetchPrivatePosts",{page:e+1}),s.value.push(...o.value.posts))},u=e=>{r.value.getBoundingClientRect().bottom<window.innerHeight&&l()};C(async()=>{const{postId:e}=n.query;e?await t.dispatch("post/fetchPrivatePosts",{postId:e}):await t.dispatch("post/fetchPrivatePosts",{authorId:c}),s.value.push(...o.value.posts),window.addEventListener("scroll",u)}),R(()=>{window.removeEventListener("scroll",u)});const o=v(()=>t.getters["post/privatePosts"]),P=async e=>{s.value.length=0,await t.dispatch("post/fetchPrivatePosts",{sortby:e,page:1}),s.value.push(...o.value.posts)},N=async e=>{s.value.length=0,await t.dispatch("post/initPrivateData"),c===a?e!==""?await t.dispatch("post/fetchPrivatePosts",{authorId:a,keyword:e}):await t.dispatch("post/fetchPrivatePosts",{authorId:a}):await t.dispatch("post/fetchPrivatePosts",{keyword:e}),s.value.push(...o.value.posts)};return U((e,_)=>{t.dispatch("post/initPrivateData")}),E(async(e,_)=>{s.value.length=0,await t.dispatch("post/initPrivateData");const y=e.params.id;i.value=a==y,await t.dispatch("post/fetchPrivatePosts",{authorId:y}),s.value.push(...o.value.posts)}),{isSelf:i,storePost:o,sort:P,search:N,postsList:s,scrollComponent:r}}}),W={ref:"scrollComponent"},X={key:0};function Y(t,n,s,r,a,c){const i=L,l=I,u=S;return f(),m("div",W,[h(q,{name:"fade"},{default:V(()=>[t.isSelf?F("",!0):(f(),m("div",X,[h(i)]))]),_:1}),h(l,{sort:t.storePost.sortby,onSort:t.sort,onSearch:t.search},null,8,["sort","onSort","onSearch"]),h(u,{posts:t.postsList},null,8,["posts"])],512)}var et=B(Q,[["render",Y],["__scopeId","data-v-4bd7df02"]]);export{et as default};
